<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>清华集训 2017 题解 | OwenOwl</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Day 1 A. 生成树计数考虑这棵树的 $\mathrm{prufer}$ 序列，设 $d_i$ 表示 $i$ 在 $\mathrm{prufer}$ 序列中出现的次数，则有 $\sum d_i &#x3D; n - 2$。 考虑一个序列 $d$ 的贡献，是 $$\begin{eqnarray}&amp;&amp;\frac{(n-2)!}{\prod d_i!}\prod(d_i+1)^ma_i^{d_">
<meta property="og:type" content="article">
<meta property="og:title" content="清华集训 2017 题解">
<meta property="og:url" content="https://owenowl.github.io/thujx/index.html">
<meta property="og:site_name" content="OwenOwl">
<meta property="og:description" content="Day 1 A. 生成树计数考虑这棵树的 $\mathrm{prufer}$ 序列，设 $d_i$ 表示 $i$ 在 $\mathrm{prufer}$ 序列中出现的次数，则有 $\sum d_i &#x3D; n - 2$。 考虑一个序列 $d$ 的贡献，是 $$\begin{eqnarray}&amp;&amp;\frac{(n-2)!}{\prod d_i!}\prod(d_i+1)^ma_i^{d_">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-09-28T12:08:00.000Z">
<meta property="article:modified_time" content="2022-04-06T10:01:23.825Z">
<meta property="article:author" content="OwenOwl">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="OwenOwl" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">OwenOwl</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://owenowl.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-thujx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/thujx/" class="article-date">
  <time datetime="2018-09-28T12:08:00.000Z" itemprop="datePublished">2018-09-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      清华集训 2017 题解
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Day-1-A-生成树计数"><a href="#Day-1-A-生成树计数" class="headerlink" title="Day 1 A. 生成树计数"></a>Day 1 A. 生成树计数</h3><p>考虑这棵树的 $\mathrm{prufer}$ 序列，设 $d_i$ 表示 $i$ 在 $\mathrm{prufer}$ 序列中出现的次数，则有 $\sum d_i = n - 2$。</p>
<p>考虑一个序列 $d$ 的贡献，是</p>
<p>$$<br>\begin{eqnarray}<br>&amp;&amp;\frac{(n-2)!}{\prod d_i!}\prod(d_i+1)^ma_i^{d_i+1}\sum (d_i+1)^m\<br>&amp;=&amp;(n-2)!\prod a_i \sum_j \frac{1}{\prod d_i!} \prod a_i^{d_i}\prod_{i\ne j}(d_i+1)^m (d_j+1)^{2m}<br>\end{eqnarray}<br>$$</p>
<p>设后面这个 $\sum$ 关于 $\sum d_i$ 的生成函数是 $F(x)$。再设</p>
<p>$$<br>\begin{eqnarray}<br>A(x)&amp;=&amp;\sum_{k} \frac{1}{k!} (k+1)^m x^k\<br>B(x)&amp;=&amp;\sum_{k} \frac{1}{k!} (k+1)^{2m} x^k\<br>\end{eqnarray}<br>$$</p>
<p>考虑枚举 $(d_i+1)^{2m}$ 是哪一项被算的，则有</p>
<p>$$<br>\begin{eqnarray}<br>F(x)&amp;=&amp;\sum_i B(a_ix) \prod_{j\ne i} A(a_j x)\<br>&amp;=&amp;\sum_i \frac{B(a_i x)}{A(a_i x)} \prod_i A(a_ix)\<br>&amp;=&amp;\sum_i \frac{B(a_i x)}{A(a_i x)} \cdot \exp {\sum_i \ln A(a_ix)}\<br>\end{eqnarray}<br>$$</p>
<p>求出 $\frac{B(x)}{A(x)}$ 和 $\ln A(x)$ 后，需要代入 $a_ix$ 并求和，于是还要对 $k \in [ 0, n-1 ) $ 预处理一个 $\sum_i a_i^k$。</p>
<p>总复杂度 $O(n\log^2 n)$</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/rpKZtz4skz/</span><br></pre></td></tr></table></figure>

<h3 id="Day-1-B-无限之环"><a href="#Day-1-B-无限之环" class="headerlink" title="Day 1 B. 无限之环"></a>Day 1 B. 无限之环</h3><p>跑费用流，对于度数 $0,1,4$ 的点直接建边，对于度数 $2$ 的点可以拆成上下和左右两部分建边，对于度数 $3$ 的点解个方程。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/wmGJFWWPTd/</span><br></pre></td></tr></table></figure>

<h3 id="Day-1-C-Hello-world"><a href="#Day-1-C-Hello-world" class="headerlink" title="Day 1 C. Hello world!"></a>Day 1 C. Hello world!</h3><p>设一个 $M$， 对 $k &gt; M$ 的操作，暴力修改暴力查询；对 $k \le M$ 的操作，重建 $M$ 棵树，查询时搞个 BIT，修改的时候暴力向上找，修改到 $1$ 了就并查集合并一下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/vcwSJCgytT/</span><br></pre></td></tr></table></figure>

<h3 id="Day-2-A-小-Y-和地铁"><a href="#Day-2-A-小-Y-和地铁" class="headerlink" title="Day 2 A. 小 Y 和地铁"></a>Day 2 A. 小 Y 和地铁</h3><p>考虑两个线段 $[l_1,r_1]$ 和 $<a href="l_1%3Cl_2">l_2,r_2</a>$，如果前者包含后者，则后者的端点方向不同造成 $1$ 的代价；如果交叉，则 $r_1$ 和 $l_2$ 的方向相同造成 $1$ 的代价。直接枚举是 $2^n$ 的。</p>
<p>考虑按左端点排序以后，如果知道了前 $i$ 条线段的右端点方向，那么可以直接贪心出 $i$ 的左端点方向，因此是 $2^{\frac{n}{2}}$ 的，加上最优解剪枝即可过。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/BpVrvCWgH7/</span><br></pre></td></tr></table></figure>

<h3 id="Day-2-B-小-Y-和二叉树"><a href="#Day-2-B-小-Y-和二叉树" class="headerlink" title="Day 2 B. 小 Y 和二叉树"></a>Day 2 B. 小 Y 和二叉树</h3><p>先求出所有子树/子树外的最小的序列开头。</p>
<p>首先编号最小的度数 $\le 2$ 的点一定是序列开头，在树的最左下方。</p>
<p>如果固定了某个点作为当前子问题的序列开头，可以贪心右儿子和右父亲的放法，递归求解。如果固定了某个点作为当前子问题的根，可以贪心左右儿子的放法，递归求解。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/wH4cJrTDqM/</span><br></pre></td></tr></table></figure>

<h3 id="Day-2-C-小-Y-和恐怖的奴隶主"><a href="#Day-2-C-小-Y-和恐怖的奴隶主" class="headerlink" title="Day 2 C. 小 Y 和恐怖的奴隶主"></a>Day 2 C. 小 Y 和恐怖的奴隶主</h3><p>搜一下发现状态最多 $165$ 个，加上记答案一共 $166$ 维，先预处理出 $2$ 的次幂的答案，然后询问的时候用向量乘矩阵，复杂度就是 $S^3\log n + T S^2 \log n$（$S$ 是维数）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/26SDwXckck/</span><br></pre></td></tr></table></figure>

<h3 id="Day-3-A-简单数据结构"><a href="#Day-3-A-简单数据结构" class="headerlink" title="Day 3 A. 简单数据结构"></a>Day 3 A. 简单数据结构</h3><p>这个题由于限制了每个数的插入次数最多为 $10$，所以总复杂度很稳。</p>
<p>给每一个数开一个桶记录一下后面长为 $d$ 的答案数量，每次后端插删的时候更新约数，然后更新约数的约数。前端插删的时候枚举倍数暴力求一下这个数的答案就行了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/CXXfVKw5JX/</span><br></pre></td></tr></table></figure>

<h3 id="Day-3-B-福若格斯"><a href="#Day-3-B-福若格斯" class="headerlink" title="Day 3 B. 福若格斯"></a>Day 3 B. 福若格斯</h3><p>首先手推一下每个数的 surreal number。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*:    LL_RR LRL_R L_RLR</span><br><span class="line">up:   L_LRR</span><br><span class="line">down: LLR_R</span><br><span class="line">-1:   _RLLR _RLRL R_RLL</span><br><span class="line">+1:   LRRL_ RLRL_ RRL_L</span><br><span class="line">-1/2: LR_RL</span><br><span class="line">+1/2: RL_LR</span><br><span class="line">0:    Rest All</span><br></pre></td></tr></table></figure>

<p>这里规定 ${0|0}=*$ 表示先手胜，${0|<em>}=\uparrow$，${</em>|0}=\downarrow$</p>
<p>然后一共有 $0,\pm1,\pm \frac{1}{2},*,\uparrow,\downarrow$ 一共 $8$ 种状态，其中前 $5$ 种可以求和，组合数算一下 $&gt;0,=0,&lt;0$ 的方案数分别有多少。</p>
<p>然后 $\sum =0$ 的状态会受到 $<em>$ 的奇偶性和 $\uparrow,\downarrow$ 哪个比较多影响。需要注意的是 $</em>$ 产生影响的话 $\uparrow,\downarrow$ 的个数差需要 $&gt;1$ 才会造成对应的影响。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/bgxYJ6fgf5/</span><br></pre></td></tr></table></figure>

<h3 id="Day-3-C-避难所"><a href="#Day-3-C-避难所" class="headerlink" title="Day 3 C. 避难所"></a>Day 3 C. 避难所</h3><p>可以发现样例的构造方法是 ${2\times 3,2\times 3,2\times 3} \Rightarrow {3,3,3,2\times 2\times 2}$。</p>
<p>于是可以构造最优解是 ${x\times y,x\times y,x\times y}$，而贪心解是 ${x,x,x,y\times y\times y}$ 的东西。$n$ 足够大的时候大致取 $y &lt; n^{1/3},x&gt;n^{1/2}$ 即可。</p>
<p>$n$ 小的话就暴力一下形如 ${a,b,b}$ 的答案是否可行即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/YMKMxH4TYP/</span><br></pre></td></tr></table></figure>

<h3 id="Day-4-A-我的生命已如风中残烛"><a href="#Day-4-A-我的生命已如风中残烛" class="headerlink" title="Day 4 A. 我的生命已如风中残烛"></a>Day 4 A. 我的生命已如风中残烛</h3><p>首先考虑暴力，每次暴力找后继绕过去，如果绕的时候出现了绕着一个凸包转多圈的情况，相当于可以直接模掉这个凸包的长度。所以每次找循环节，线转一圈长度至少减半。</p>
<p>优化找后继，可以以每个点为中心预处理出极角序，再预处理从某个点过来的时候的第一个可行位置，转的时候拿个指针扫下去就行了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/cbkGYxQw4Z/</span><br></pre></td></tr></table></figure>

<h3 id="Day-4-B-榕树之心"><a href="#Day-4-B-榕树之心" class="headerlink" title="Day 4 B. 榕树之心"></a>Day 4 B. 榕树之心</h3><p>DP 出一个子树内部互相消，可以消成至少几个点。那么就是把儿子中大小最大的挑出来，看其它儿子能不能把这个消没有。特判一下奇偶。</p>
<p>对 $i$ 的答案可以把 $1\to i$ 的路径缩成一个点求一下 DP 值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/S6rMpnPhTt/</span><br></pre></td></tr></table></figure>

<h3 id="Day-4-C-某位歌姬的故事"><a href="#Day-4-C-某位歌姬的故事" class="headerlink" title="Day 4 C. 某位歌姬的故事"></a>Day 4 C. 某位歌姬的故事</h3><p>首先离散化，求出每一段的最大值，判一下不合法。</p>
<p>然后对于同一个最大值，把这个最大值的区间全部抠出来，再把是这个最大值的限制全部抠出来，做一个 DP 就行了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://paste.ubuntu.com/p/dWTw4NmFFk/</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://owenowl.github.io/thujx/" data-id="cl1neiqug0002wci65vn248tq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/BZOJ3864/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">BZOJ3864 题解</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/thujx/">清华集训 2017 题解</a>
          </li>
        
          <li>
            <a href="/BZOJ3864/">BZOJ3864 题解</a>
          </li>
        
          <li>
            <a href="/poly2/">多项式题目“啖光之花”题解</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 OwenOwl<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>